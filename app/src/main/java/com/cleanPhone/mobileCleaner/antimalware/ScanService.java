package com.cleanPhone.mobileCleaner.antimalware;

import android.content.Context;
import android.content.pm.ApplicationInfo;
import android.content.pm.PackageInfo;
import android.os.AsyncTask;

import com.cleanPhone.mobileCleaner.utility.GlobalData;
import com.cleanPhone.mobileCleaner.utility.SharedPrefUtil;
import com.cleanPhone.mobileCleaner.utility.Util;
import com.cleanPhone.mobileCleaner.wrappers.PackageInfoStruct;

import java.util.ArrayList;
import java.util.List;

public class ScanService extends AsyncTask<String, String, ArrayList> {
    private static final String TAG = "SCAN_SERVICE";
    private int appCount;
    private Context context;

    public ScanService(Context context) {
        this.context = context;
    }

    private int getAppCount(List<PackageInfo> list) {
        for (int i = 0; i < list.size(); i++) {
            PackageInfo packageInfo = list.get(i);
            ApplicationInfo applicationInfo = packageInfo.applicationInfo;
            if ((applicationInfo.flags & 1) == 0) {
                String str = (String) applicationInfo.loadLabel(this.context.getPackageManager());
                if (packageInfo.versionName != null && !str.equalsIgnoreCase("Google play services") && !str.equalsIgnoreCase("Google play store") && !str.equalsIgnoreCase("APC Rebrand")) {
                    this.appCount++;
                }
            }
        }
        return this.appCount;
    }

    public ArrayList<FilesInclude> doInBackground(String[] strArr) {
        PackageInfo packageInfo;
        DBHelper dBHelper;
        PackageInfoStruct packageInfoStruct;
        ArrayList<FilesInclude> arrayList = new ArrayList<>();
        Context applicationContext = this.context.getApplicationContext();
        DBHelper dBHelper2 = new DBHelper(applicationContext, new SharedPrefUtil(this.context).getInt(SharedPrefUtil.CURRENTDB) + GlobalData.DB_NAME);
        ArrayList<Long> fileData = dBHelper2.getFileData();
        Util.appendLogmobicleanTest(TAG, "scanning apps ", "dblog.txt");
        char c2 = 0;
        List<PackageInfo> installedPackages = this.context.getPackageManager().getInstalledPackages(0);
        this.appCount = getAppCount(installedPackages);
        int i = 0;
        int i2 = 0;
        while (i < installedPackages.size()) {
            if (ScannigActivity.stopScanning) {
                i = installedPackages.size() - 1;
            }
             int i3 = i;
            packageInfo = installedPackages.get(i3);
            if (packageInfo.versionName != null) {
                packageInfoStruct = new PackageInfoStruct();
                if ((packageInfo.applicationInfo.flags & 1) == 0) {
                    try {
                        Thread.sleep(100L);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                    String[] strArr2 = new String[4];
                    strArr2[c2] = "" + ((Object) packageInfo.applicationInfo.loadLabel(this.context.getPackageManager()));
                    strArr2[1] = packageInfo.packageName;
                    strArr2[2] = String.valueOf(i2);
                    strArr2[3] = String.valueOf(this.appCount);
                    publishProgress(strArr2);
                    i2++;
                    String charSequence = packageInfo.applicationInfo.loadLabel(this.context.getPackageManager()).toString();
                    packageInfoStruct.appname = charSequence;
                    try {
                        if (!charSequence.equalsIgnoreCase("Google play services")) {
                            if (!packageInfoStruct.appname.equalsIgnoreCase("Google play store")) {
                            }
                        }
                    } catch (Exception e2) {
                        e2.printStackTrace();
                    }
                }
            }
            dBHelper = dBHelper2;
            i = i3 + 1;
            dBHelper2 = dBHelper;
            c2 = 0;
        }


        return arrayList;
    }
}