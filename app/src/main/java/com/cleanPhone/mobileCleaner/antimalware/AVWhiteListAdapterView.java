package com.cleanPhone.mobileCleaner.antimalware;

import android.annotation.SuppressLint;
import android.content.Context;
import android.content.pm.PackageManager;
import android.view.LayoutInflater;
import android.view.MotionEvent;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.recyclerview.widget.RecyclerView;

import com.codersroute.flexiblewidgets.FlexibleSwitch;
import com.cleanPhone.mobileCleaner.R;
import com.cleanPhone.mobileCleaner.utility.FileUtil;
import com.cleanPhone.mobileCleaner.utility.GlobalData;
import com.cleanPhone.mobileCleaner.wrappers.PackageInfoStruct;

import java.io.File;
import java.util.ArrayList;

public class AVWhiteListAdapterView extends RecyclerView.Adapter<AVWhiteListAdapterView.VHolder> {
    private final Context context;
    private ArrayList<PackageInfoStruct> dataList;
    private ArrayList<FilesInclude> ignoredList;


    public class VHolder extends RecyclerView.ViewHolder {
        private ImageView img_app;
        private final FlexibleSwitch onoffBtn;
        public TextView size;
        public TextView title;

        public VHolder(AVWhiteListAdapterView aVWhiteListAdapterView, View view) {
            super(view);
            setIsRecyclable(false);
            this.title = (TextView) view.findViewById(R.id.tvsocial_app_name);
            this.img_app = (ImageView) view.findViewById(R.id.img_ignoreapp);
            this.size = (TextView) view.findViewById(R.id.tvsocial_app_size);
            this.onoffBtn = (FlexibleSwitch) view.findViewById(R.id.ignore_onoff);
            try {
                aVWhiteListAdapterView.ignoredList = (ArrayList) GlobalData.getObj(aVWhiteListAdapterView.context, "av_white");
            } catch (Exception e) {
                e.printStackTrace();
                aVWhiteListAdapterView.ignoredList = new ArrayList();
            }
        }
    }

    public AVWhiteListAdapterView(Context context, ArrayList arrayList) {
        this.dataList = arrayList;
        this.context = context;
    }

    @Override
    public int getItemCount() {
        return this.dataList.size();
    }

    @Override
    public void onBindViewHolder(@NonNull final VHolder vHolder, int i) {
        final PackageInfoStruct packageInfoStruct = this.dataList.get(i);
        TextView textView = vHolder.title;
        textView.setText("" + packageInfoStruct.appname);
        vHolder.onoffBtn.setClickable(false);
        vHolder.onoffBtn.setFocusable(false);
        try {
            vHolder.img_app.setImageDrawable(this.context.getPackageManager().getApplicationIcon(packageInfoStruct.pname));
        } catch (PackageManager.NameNotFoundException e) {
            e.printStackTrace();
        }
        vHolder.onoffBtn.setOnTouchListener(new View.OnTouchListener() {
            @SuppressLint("ClickableViewAccessibility")
            @Override
            public boolean onTouch(View view, MotionEvent motionEvent) {
                try {
                    packageInfoStruct.ignored = vHolder.onoffBtn.isChecked();
                    if (vHolder.onoffBtn.isChecked()) {
                        vHolder.onoffBtn.setChecked(true);
                        ArrayList arrayList = AVWhiteListAdapterView.this.ignoredList;
                        File file = new File(packageInfoStruct.apkPath);
                        long convertCRC64 = FileUtil.convertCRC64(packageInfoStruct.pname);
                        PackageInfoStruct packageInfoStruct2 = packageInfoStruct;
                        arrayList.add(new FilesInclude(file, convertCRC64, 0L, packageInfoStruct2.pname, packageInfoStruct2.appname, true));
                    } else {
                        vHolder.onoffBtn.setChecked(false);
                        for (int i2 = 0; i2 < AVWhiteListAdapterView.this.ignoredList.size(); i2++) {
                            if (((FilesInclude) AVWhiteListAdapterView.this.ignoredList.get(i2)).getPkgName().equalsIgnoreCase(packageInfoStruct.pname)) {
                                AVWhiteListAdapterView.this.ignoredList.remove(i2);
                                break;
                            }
                        }
                    }
                    try {
                        GlobalData.saveObj(AVWhiteListAdapterView.this.context, "av_white", AVWhiteListAdapterView.this.ignoredList);
                    } catch (Exception e2) {
                        e2.printStackTrace();
                    }
                } catch (Exception e3) {
                    e3.printStackTrace();
                }
                return false;
            }
        });
        if (packageInfoStruct.ignored) {
            vHolder.onoffBtn.setChecked(true);
        } else {
            vHolder.onoffBtn.setChecked(false);
        }
    }

    @Override
    @NonNull
    public VHolder onCreateViewHolder(@NonNull ViewGroup viewGroup, int i) {
        return new VHolder(this, LayoutInflater.from(viewGroup.getContext()).inflate(R.layout.ignore_app_adapter, viewGroup, false));
    }
}
